var PKT_EXT=PKT_EXT||{};PKT_EXT.UTIL=function(){var e=function(e){return/^https?\:/i.test(e)},t=function(){return null!==navigator.platform.match(/^Mac/)},n=function(){return void 0!==window.safari},i=function(){return"localhost"==document.location.hostname},a=function(){return/OPR/.test(window.navigator.userAgent)},s=function(){return/YaBrowser/.test(window.navigator.userAgent)},o=function(){return void 0!==window.chrome&&void 0!==window.chrome.app},r=function(){return void 0!==window.chrome&&void 0!==window.chrome.app&&!a()&&!s()},u=function(){var e=k("firstName"),t=k("lastName"),n="";return"undefined"!=typeof e&&""!==e&&(n+=e),"undefined"!=typeof t&&""!==t&&(n+=""!==n?" "+t:t),""!==n?n:c()},c=function(){var e=k("username");if("undefined"!=typeof e&&e.length>0&&"*"!==e.charAt(0))return e;var t=k("email");return"undefined"!=typeof t&&""!==t?t:"Pocket User"},d=function(e){return o()?e.incognito:n()?safari.application.privateBrowsing.enabled:void 0},f=function(){var e=navigator.language;return e="undefined"!=typeof e?e.toLowerCase():"en",0===e.indexOf("en")?"en":0===e.indexOf("de")?"de":0===e.indexOf("fr")?"fr":0===e.indexOf("it")?"it":0===e.indexOf("es_419")?"es_419":0===e.indexOf("es")?"es":0===e.indexOf("ja")?"ja":0===e.indexOf("ru")?"ru":0===e.indexOf("ko")?"ko":0===e.indexOf("nl")?"nl":0===e.indexOf("pl")?"pl":0===e.indexOf("pt_BR")?"pt_BR":0===e.indexOf("pt_PT")?"pt_PT":0===e.indexOf("zh_CN")?"zh_CN":0===e.indexOf("zh_TW")?"zh_TW":"en"},g=function(){var e=o()?chrome.extension.getBackgroundPage():safari.extension.globalPage.contentWindow;return e},p=function(e){if(o())chrome.tabs.getSelected(null,function(t){e(t)});else if(n()){var t=safari.application.activeBrowserWindow.activeTab;e(t)}},l=function(e){if(o())chrome.tabs.query({},e);else if(n()){for(var t=safari.application.browserWindows,i=[],a=0;a<t.length;a++)for(var s=t[a].tabs,r=0;r<s.length;r++)i.push(s[r]);e(i)}else e([])},m=function(e,t){if(o())chrome.tabs.executeScript(e.id,{code:t});else if(n()){if(!e||!e.page||!e.page.dispatchMessage)return;e.page.dispatchMessage("executeScript",t)}},v=function(e,t,i){o()?chrome.tabs.executeScript(e.id,{code:t},i):n()&&(m(e,t),setTimeout(i,100))},h=function(e,t){if(o())chrome.tabs.executeScript(e.id,{file:t});else if(n()){var i=$.ajax({type:"GET",url:"../"+t,async:!1});m(e,i.responseText)}},_=function(e,t,i){if(o())chrome.tabs.executeScript(e.id,{file:t},i);else if(n()){var a=$.ajax({type:"GET",url:"../"+t,async:!1});v(e,a.responseText,i)}},S=function(e,t){n()?safari.extension.addContentStyleSheetFromURL(t,["*"],[]):chrome.tabs.insertCSS(e.id,{file:t})},b=function(e){l(function(t){for(var n=0;n<t.length;n++){var i=t[n];I(i,e)}})},x=function(e){var t="("+e+")();",n=document.createElement("script");n.textContent=t,(document.head||document.documentElement).appendChild(n),n.parentNode.removeChild(n)},T=function(e,t){if("undefined"==typeof t&&(t=!1),o())return void chrome.tabs.create({url:e,active:!t});if(n()){var i=t?"background":"",a=safari.application.activeBrowserWindow.openTab(i);a.url=e}},w=function(e){return e===!1?"false":"true"},y=function(e){return"string"==typeof e?"false"!==e:e},k=function(e){return C(e)[e]},O=function(e,t){var n=C(e);t||n!=localStorage?n[e]=t:localStorage.removeItem(e)},C=function(e){if(n()){var t,i=["twitter","hackernews","reddit","yahoo","linkedin","keyboard-shortcut-add","keyboard-shortcut"];return t=-1!==i.indexOf(e)?safari.extension.settings:"username"===e||"password"===e?safari.extension.secureSettings:localStorage}return localStorage},L=function(e){if(o()){if(window.chrome.extension.onMessage)return void chrome.extension.onMessage.addListener(e);chrome.extension.onRequest.addListener(e)}else if(n()){var t;if(safari.self&&safari.self.addEventListener?t=safari.self:safari.application&&safari.application.addEventListener&&(t=safari.application),!t)return;t.addEventListener("message",function(t){t.tab=t.target;var n;if(t.message.__cbId){var i=t.tab,a=t.message.__cbId;n=function(e){i&&i.page&&i.page.dispatchMessage&&i.page.dispatchMessage("__performCb",{cbId:a,data:e})},t.__cbId=void 0}e(t.message,t,n)},!1)}},I=function(e,t){if(o())chrome.tabs.sendMessage(e.id,t);else if(n()){if(!e||!e.page||!e.page.dispatchMessage)return;e.page.dispatchMessage("message",t)}},U=function(e,t){t||(t=function(e){}),o()?chrome.extension.sendMessage?chrome.extension.sendMessage(e,t):chrome.extension.sendRequest(e,t):n()&&(t&&(e.__cbId=Callbacker.addCb(t)),safari.self.tab.dispatchMessage("message",e))},M=function(){var e=["webkit","moz","ms","o"];if("hidden"in document)return"hidden";for(var t=0;t<e.length;t++)if(e[t]+"Hidden"in document)return e[t]+"Hidden";return null},N=function(){var e=M();return e?document[e]:!1},A=function(e){var t=M();if(t){var n=t.replace(/[H|h]idden/,"")+"visibilitychange";document.addEventListener(n,e)}};return{isLocal:i,isValidURL:e,isMac:t,isSafari:n,isOpera:a,isYandex:s,isChrome:o,isChromeOnly:r,getDisplayName:u,getDisplayUsername:c,inPrivateMode:d,getCurrentLanguageCode:f,getBackgroundPage:g,getCurrentTab:p,getAllTabs:l,executeScriptInTab:m,executeScriptInTabWithCallback:v,executeScriptFromURLInTab:h,executeScriptFromURLInTabWithCallback:_,executeStyleFromURLInTab:S,broadcastMessageToAllTabs:b,injectScript:x,openTabWithURL:T,stringFromBool:w,boolFromString:y,getSetting:k,setSetting:O,settingContainerForKey:C,addMessageListener:L,sendMessageToTab:I,sendMessage:U,getHiddenProp:M,isHidden:N,addHiddenEventListener:A}}(),PKT_EXT.API=function(e){function t(e){var t=x+e.path,n=e.data||{};n.consumer_key=S,$.ajax({url:t,type:"POST",headers:{"X-Accept":"application/json"},data:n,dataType:"json",success:e.success,error:e.error})}function n(e){t({path:"/oauth/is_valid_token",data:{access_token:T("oauth_token")},success:function(t){e&&e(!0)},error:function(t){e&&e(!1)}})}function i(){return"undefined"!=typeof T("username")&&"undefined"!=typeof T("oauth_token")}function a(){setSetting("username",void 0),setSetting("email",void 0),setSetting("firstName",void 0),setSetting("lastName",void 0),setSetting("oauth_token",void 0),setSetting("premium_status",void 0),setSetting("tagsFetchedSince",void 0),setSetting("tags",void 0),setSetting("usedTags",void 0),setSetting("password",void 0),setSetting("token",void 0),setSetting("guid",void 0),setSetting("heartbeatTimestamp",void 0),setSetting("alreadyLoggedIn",void 0),l(function(e){setSetting("guid",void 0),setSetting("heartbeatTimestamp",void 0)}),setSetting("premUpsell",void 0),setSetting("premUpsellTime",void 0),setSetting("premUpsellCount",void 0),setSetting("saveCount",void 0)}function s(e,n){n=n||{};t({path:"/oauth/authorize",data:{guid:T("guid"),token:e.token,user_id:e.userId,account:"1",grant_type:"extension"},success:function(e){var t=e.username,i=e.access_token,a=e.account,s=a.email,o=a.first_name||"",r=a.last_name||"",u=a.premium_status;setSetting("username",t),setSetting("email",s),setSetting("firstName",o),setSetting("lastName",r),setSetting("oauth_token",i),setSetting("token",void 0),setSetting("premium_status",u),n.success&&n.success(),d()},error:function(e,t,i){console.log("Login Error:"),console.log(e.error),n.error&&n.error.apply(n,Array.apply(null,arguments))}})}function o(e,t,n){var i={action:"add",url:t,title:e};c(i,n)}function r(e,t){var n={action:"delete",item_id:e};c(n,t)}function u(e,t){var n={action:"archive",item_id:e};c(n,t)}function c(e,n){"undefined"!=typeof n.actionInfo&&(e=$.extend(e,n.actionInfo)),t({path:"/send",data:{access_token:T("oauth_token"),actions:JSON.stringify([e])},success:function(e){n.success&&n.success(e)},error:function(e){401===e.status&&a(),n.error&&n.error(e.status,e)}})}function d(e){if(i()){e=e||{};var n=T("tagsFetchedSince"),a=T("premium_status"),s={access_token:T("oauth_token"),tags:1,taglist:1,account:1,since:n?n:0};"undefined"==typeof a&&(s.forceaccount=1),t({path:"/get",data:s,success:function(t){t.account&&setSetting("premium_status",t.account.premium_status),t.tags&&setSetting("tags",JSON.stringify(t.tags)),setSetting("tagsFetchedSince",t.since),e.success&&e.success()},error:function(t){e.error&&e.error()}})}}function f(e,t,n){var i={action:"tags_add",url:e,tags:t},a=n.success;n.success=function(e){for(var n=T("usedTags"),i=n?JSON.parse(n):{},s=0;s<t.length;s++){var o=t[s].trim(),r={tag:o,timestamp:new Date};i[o]=r}setSetting("usedTags",JSON.stringify(i)),a&&a(e)},c(i,n)}function g(e){var t=function(){var t=T("tags"),n="";t&&(n=JSON.parse(t));var i=T("usedTags"),a=[];if(i){var s=JSON.parse(i),o=[];for(var r in s)o.push(s[r]);o.sort(function(e,t){return e=new Date(e.timestamp),t=new Date(t.timestamp),t>e?-1:e>t?1:0});for(var u=0;u<o.length;u++)a.push(o[u].tag);a.reverse()}e&&e(n,a)};d({success:t,error:t})}function p(e,n){i()&&(n=n||{},t({path:"/suggested_tags",data:{access_token:T("oauth_token"),url:e},success:function(e){n.success&&n.success(e)},error:function(e){n.error&&n.error(e.status,e)}}))}function l(e){if(isChromeOnly()){var t=T("heartbeatTimestamp"),n=Date.now(),i=864e5;if("undefined"==typeof t||n-t>i){var a=T("guid");if("undefined"==typeof a)return void ril.getGuid(function(e){e.tests&&(e.tests.extension_install_signup_v1&&setSetting("experimentVariant",e.tests.extension_install_signup_v1.option),!e.tests.premium_ext_upsell_v2||"show_upsell"!=e.tests.premium_ext_upsell_v2.option||"en-us"!=window.navigator.language.toLowerCase()&&"en"!=window.navigator.language.toLowerCase()?setSetting("premUpsell","0"):setSetting("premUpsell","1")),e.guid?(setSetting("guid",e.guid),l()):setTimeout(l,36e5)});if("undefined"!=typeof T("oauth_token")&&"undefined"!=typeof T("guid")){var s="control";"1"!==T("premium_status")&&"1"==T("premUpsell")&&(s="show_upsell"),ril.sendAbTestTrack(T("guid"),T("oauth_token"),"premium_ext_upsell_v2",s)}chrome.windows.getAll({populate:!0},function(t){for(var i=0,s=0;s<t.length;s++)i+=t[s].tabs.length;ril.sendHeartbeat(a,i,t.length,function(t){t?(setSetting("heartbeatTimestamp",n),e&&e(n)):setTimeout(l,36e5)})})}else{var a=T("guid");"undefined"==typeof a&&ril.getGuid(function(e){e.guid&&setSetting("guid",e.guid),e.tests&&(e.tests.extension_install_signup_v1&&setSetting("experimentVariant",e.tests.extension_install_signup_v1.option),!e.tests.premium_ext_upsell_v2||"show_upsell"!=e.tests.premium_ext_upsell_v2.option||"en-us"!=window.navigator.language.toLowerCase()&&"en"!=window.navigator.language.toLowerCase()?setSetting("premUpsell","0"):setSetting("premUpsell","1"))})}}}function m(e,n,i,a){return"undefined"!=typeof e&&e?void t({path:"/pv",data:{access_token:T("oauth_token"),guid:e,actions:JSON.stringify([{view:"ext_heartbeat",cxt_t:n,cxt_w:i}])},success:function(e){a&&a(!0)},error:function(e){a&&a(!1)}}):void(a&&a(!1))}function v(e){t({path:"/guid",data:{abt:1},success:function(t){e&&e(t.status?t:!1)},error:function(t){e&&e(!1)}})}function h(e,n,i,a,s){t({path:"/abtr",data:{guid:e,access_token:n,actions:JSON.stringify([{action:"pv_ab",ab_test:i,ab_test_option:a}])},success:function(e){s&&s(e.status?!0:!1)},error:function(e){s&&s(!1)}})}function _(e,n,i){return"undefined"!=typeof e&&e?void t({path:"/pv",data:{access_token:T("oauth_token"),guid:e,actions:JSON.stringify([{view:"web",type_id:1,section:"extension",page:n}])},success:function(e){i&&i(!0)},error:function(e){i&&i(!1)}}):void(i&&i(!1))}var S,b,x="https://getpocket.com/v3",T=e.UTIL.getSetting;return e.UTIL.isSafari()?(S="9346-1e342af73fe11d5174042e9d",b="135gbu4epq447VX194TjSfto95A0jbz0"):e.UTIL.isOpera()?(S="15449-d65f5fdc5cbb3fef26248f12",b="3a6ZtR00Aa825u31drgc530b97d9te43"):e.UTIL.isYandex()?(S="23283-dd493d5fba22fd9b6f39e35a",b="3a6ZtR00Aa825u31drgc530b97d9te43"):e.UTIL.isChromeOnly()&&(S="7035-d3382df43fe0195174c42f9c",b="801p7PR9A5b78x11f4ghRD8CVFdrA689"),{isAuthorized:i,login:s,logout:a,add:o,remove:r,archive:u,addTags:f,getTags:g,getSuggestedTags:p,setupHeartbeat:l,sendHeartbeat:m,getGuid:v,sendAbTestTrack:h,sendAnalyticsCall:_,isValidToken:n}}(PKT_EXT||{});