function getURLParameter(e){var t=RegExp("[?|&]"+e+"=(.+?)(&|$)").exec(decodeURI(location.search));return t?t[1]:null}function dateToday(){var e=new Date;return e.getUTCFullYear()+"-"+(parseInt(e.getMonth())+1)+"-"+e.getDate()+" "+e.getHours()+":"+e.getMinutes()+":"+e.getSeconds()}function generateUuid(e,t){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(e){var t=16*Math.random()|0,i="x"==e?t:3&t|8;return i.toString(16)})}AB={},_.extend(FA,{resync:function(){}}),PB.API.onDown.addListener(function(){chrome.extension.sendMessage({message:"set_mode_offline"})}),PB.API.onUp.addListener(function(){if(PB.Authentication.isAuthenticated()){if(PB.Authentication.isOnline())return;return void PB.Authentication.login({_PB:{skipOnDownNotify:!0,skipOldUserDiscard:!0}},function(e){e&&chrome.extension.sendMessage({message:"set_mode_online"})})}}),PB.API.on401.addListener(function(){FA.Background.doLogout(),chrome.extension.sendMessage({message:"kick_out"})}),"undefined"!=typeof IS_BUNDLED_EXE&&localStorage.setItem("is_bundled_exe",!0),FA.Background.fetchLocale(),FA.Background.locale=localStorage.getItem("pb_locale")||"us",FA.Background.ignoredNeverSignedUp=function(){var e=localStorage.getItem("ignoreNeverSignedUp");return e="string"==typeof e?JSON.parse(e):[]}(),PB.BI.getAtlasMeta("facebook.com",function(e,t){e&&PB.debug("fa:init")("Failed to retrieve atlas data: "+e)});try{if(localStorage.getItem("profilePictureData")){var data=localStorage.getItem("profilePictureData");if(localStorage.removeItem("profilePictureData"),!localStorage.getItem("profile")){var json=FA.Crypto.decryptWithAES(data,"profilePictureData"),info=JSON.parse(json)||{};info.fa_cpassword=info.fa_cpassword||"",info.fa_member=info.fa_member||{},info.fa_member.id=info.member_id,info.fa_member.cid=info.member_cid,info.fa_member.key=info.member_key,_.extend(FA.Background,info),FA.v(!0),FA.Background.fa_login=null,FA.Background.fa_cpassword=null}}}catch(e){console.error("Could not auto-login user",e)}if(PB.Autologin=function(){PB.AutoLoginTimeout.check({valid:function(){PB.settings.profile.isActive({nocache:!0,success:function(e){PB.settings.key.isActive({nocache:!0,success:function(t){return e&&t?void FA.Background.hasCredentials():(FA.Background.openLoginPrompt(),void FA.Background.openWelcomeFlowAfter7Days())}})}})},invalid:function(){PB.settings.profile.reset(),PB.settings.key.reset(),FA.Background.doLogout()}})},PB.settings.uuid.get()||PB.settings.uuid.reset(),PB.MemoryMap.get("extensionInstalledTimestamp",{success:function(e){(null==e||""===e)&&(e=Math.floor(new Date/1e3),PB.MemoryMap.set("extensionInstalledTimestamp",e));var t=new Date(1e3*e);localStorage.setItem("installed",[t.getFullYear(),t.getMonth()+1,t.getDate()].join("-"))}}),chrome.extension.onMessage.addListener(function(e,t,i){if("object"==typeof e&&"message"in e)switch(e.message){case"login":FA.Background.doLogin(e.args,function(){});break;case"getSessionData":var n=e.args;if(!n)return void console.error("getSessionData requires args");!n.selfOnly||!output||t.tab&&output._tabId&&output._tabId==t.tab.id||(output=null),i(PB.SessionData[n.key]);break;case"setSessionData":var n=e.args;if(!n)return void console.error("setSessionData requires args");n.value&&t.tab&&(n.value._tabId=t.tab.id),PB.SessionData[n.key]=n.value;break;case"track":var n=e.args;if(!n)return void console.error("track requires args");PB.mixpanel.track(n.name,n.params,{},n.source)}}),chrome.storage){var tabCache={},recentTabs=[];chrome.tabs.onUpdated.addListener(function(e,t,i){tabCache[e]=i}),chrome.storage.local.get("pb_recentTabs",function(e){recentTabs=e.pb_recentTabs||[]}),chrome.tabs.onRemoved.addListener(function(e){if(tabCache[e]){var t={title:tabCache[e].title||tabCache[tabid].url,url:tabCache[e].url,closedTime:Math.floor(Date.now()/1e3)};recentTabs.push(t),recentTabs=_.uniq(recentTabs,function(e){return e.url}),delete tabCache[e],chrome.storage.local.set({pb_recentTabs:recentTabs})}})}identityManager=new function(e){PB="undefined"!=typeof PB?PB:{},chrome="undefined"!=typeof chrome?chrome:{};var t=this,i=chrome.cookies,e="undefined"!=typeof e?e:{},n=e.context||PB.config&&PB.config.target?PB.config.target:"default-extension";this.identity={distinct_id:null};var o="undefined"!=typeof tracking_env?tracking_env:"prod",a="dev"===o?"dev0":"a0",r=a+".psswrdbx.com",s="https://"+r,c=["searchthewebnow.com","i.searchthewebnow.com","search.conduit.com"],d=["p","pb_id","distinct_id","installed","utm_source","utm_medium","utm_campaign","utm_content","utm_terms","supersonic_sub_id","adp_sub_id_1","adp_sub_id_2","triggered_pixel","magic"],l={"desktop-extension-chrome":{p:"ext_fallback"},"desktop-extension-firefox":{p:"ext_fallback"},"desktop-extension-ie":{p:"ext_fallback"},"desktop-extension-safari":{p:"ext_fallback"},"desktop-frontend":{p:"public_2"}};this.policies={add:function(e,i){e in t.policies||(t.policies[e]=[]),t.policies[e].push(i)},invoke:function(e){if(e in t.policies&&t.policies[e].length>0)for(var i=0;i<t.policies[e].length;i++)t.policies[e][i].call(t)}};var u=function(e){var i=e.distinct_identity===t.identity.distinct_identity;t.identity.triggered_pixel&&t.identity.triggered_pixel===!0&&delete e.triggered_pixel,(i||!t.identity.distinct_identity)&&_.extend(t.identity,e)},g=function(e,t,n){if(n=n||"passwordbox.com",i)chrome.cookies.getAll({domain:n},function(i){for(var n=0;n<i.length;n++){var o=i[n];if(o.name==e)return"value"in o&&(o=o.value),o=decodeURIComponent(o),t(o),!1}t("")});else{var o=$.cookie(e);o="string"==typeof o?decodeURIComponent(o):"",t(o)}},f=function(e,i){g("AB",function(i){if(i&&i.length>0)try{i=JSON.parse(decodeURIComponent(i)),u(i)}catch(n){i={}}t.policies.invoke("fromCookies"),e()},i)},m=function(e){var n=c.length;_.each(c,function(o){return!i&&o&&location.href.indexOf(o)<0?(n--,0==n?(t.policies.invoke("fromFirstParty"),void e()):void 0):void g("AB",function(o){if(n--,o&&o.length>0){try{o=JSON.parse(decodeURIComponent(o))}catch(a){o={}}(i||o.from_extension)&&u(o)}0==n&&(t.policies.invoke("fromFirstParty"),e())},o)})};t._cleanPartnerParam=function(e){var t=e.match(/[\w-]+/);return t?t[0]:e};var p,y=function(e){for(var i=0;i<d.length;i++){var n=d[i],o=getURLParameter(n);o&&("pb_id"===n?_.extend(t.identity,{distinct_id:o}):"installed"===n?_.extend(t.identity,{install_date:o}):"p"===n?t.identity[n]=t._cleanPartnerParam(o):t.identity[n]=o)}t.policies.invoke("fromUrlParams"),e()},h=function(e){t.policies.invoke("fromSubDomain"),e()},v=function(e){t.policies.invoke("fromBuildScript"),e()};try{p=localStorage}catch(x){}p||(p={setItem:function(){},getItem:function(){},removeItem:function(){}});var B=function(e){"undefined"!=typeof PB&&PB.MemoryMap?PB.MemoryMap.isAvailable(function(i){if(i){var n={network:"network",thirdPartyInstallType:"install_type",experimentId:"experiment_variation",avgMachineId:"avgMachineId",networkSubId:"network_sub_id"},o=function(e){PB.MemoryMap.getMachineKey(e,{retry:i?PB.Config.LOCAL_HTTP_SERVER_MAX_RETRY_COUNT:!1,success:function(t,i){a(e,t)}})},a=function(i,o){return o&&p.setItem(n[i],o),delete n[i],Object.keys(n).length?!1:(t.policies.invoke("fromRegistry"),void e())};for(var r in n)o(r)}else e()}):e&&e()},P=function(e){var t=["https://"+a+".psswrdbx.com/tracking/sync.html"];if(window.self!==window.top)return!1;var i=document.createElement("iframe");i.src=t+e,document.getElementsByTagName("head")[0].appendChild(i)},b=function(e){if("undefined"!=typeof chrome&&chrome.cookies)f(function(){e&&e()},a+".psswrdbx.com");else if(window.self===window.top){var t=window.addEventListener?"addEventListener":"attachEvent",i=window[t],n="attachEvent"==t?"onmessage":"message";P("?sync-up=true");var o=!1,r=setTimeout(function(){o=!0,e&&e()},2e3);i(n,function(t){if(!t||t.origin===s)try{var i="string"==typeof t.data?JSON.parse(t.data):t.data;i.identity&&!o&&("string"==typeof i.identity&&(i.identity=JSON.parse(i.identity)),i.identity.distinct_id&&u(i.identity),clearTimeout(r),e&&e())}catch(n){console.log("e1 : ",n)}},!1)}else e&&e()},k=function(){var e={distinct_id:t.identity.distinct_id||generateUuid(),p:t.identity.p||(n in l?l[n].p:"public")};for(var i in e){if(i in t.identity&&t.identity[i])return;t.identity[i]=e[i]}t.policies.invoke("createIdentity")},w=function(){for(var e in t.identity)e.match(/^fb_/)&&delete t.identity[e]},S=function(e){return t.identity.distinct_id?(!t.identity.distinct_id&&t.identity.mixpanel&&(t.identity.distinct_id=t.identity.mixpanel.pb_id),!t.identity.install_date&&i&&(t.identity.install_date=dateToday()),e(!0),!1):void e(!1)},A=null;this.sync=function(e){if(w(),"undefined"!=typeof location&&location.host){var n=location.host.split("."),o=n.length>2&&"www"===n[0]?n.slice(n.length-2,n.length).join("."):n.join(".");o=o.replace(":8000",""),o.match(/\.com/)||(o="passwordbox.com")}else o="passwordbox.com";var a=function(){window.self!==window.top&&getURLParameter("sync-up")&&parent.postMessage(JSON.stringify({identity:JSON.stringify(t.identity)}),"*")},r=function(){if("undefined"!=typeof chrome&&chrome.cookies)t.identity.from_extension=!0,_.each(c,function(e){$.cookie("AB",JSON.stringify(t.identity),{expires:365,domain:e,url:"http://"+e,path:"/"})});else{if(window.self!==window.top)return;P("?"+$.param(t.identity))}},s=function(){$.cookie("AB",JSON.stringify(t.identity),{expires:365,domain:o,url:"http://"+o,path:"/"}),p.setItem("identity",JSON.stringify(t.identity))};if("undefined"!=typeof AB&&(t.identity=AB),!A||!_.isEqual(A,t.identity)||i){delete t.identity.from_extension,s(),a(),r();try{A=JSON.parse(JSON.stringify(t.identity))}catch(d){}}};var I=function(e){f(function(){b(function(){m(function(){y(function(){B(function(){h(function(){v(function(){e()})})})})})})})};this.init=function(e){var t=this;t.inited=!1,discovered=new Promise(function(e,i){I(function(){return getURLParameter("sync-up")?(t.sync(),!1):void S(function(i){i||k(),t.policies.invoke("addPersonality"),AB=t.identity,t.inited=!0,PB.mixpanel&&PB.mixpanel.release(),t.sync(),e(AB)})}),setTimeout(function(){e()},4e3)}).then(function(t){e&&e(t)})}},"undefined"!=typeof module&&module.exports&&!module.exports.PB&&(module.exports=identityManager),"undefined"!=typeof identityManager&&(identityManager.policies.add("addPersonality",function(){if(localStorage.getItem("network")&&"avg_exp"==localStorage.getItem("network")){var e=localStorage.getItem("install_type"),t=localStorage.getItem("experiment_variation"),i=localStorage.getItem("avgMachineId");_.extend(identityManager.identity,{install_type:e,experiment_variation:t,avg_machine_id:i}),t in PB.experiments.AVG&&(_.extend(identityManager.identity,PB.experiments.AVG[t].tracking),PB.experiments.AVG[t].props.blockWidget&&$.cookie("disableWidget","true",{url:"http://a0.psswrdbx.com",domain:"a0.psswrdbx.com",expires:365}))}localStorage.getItem("_partner")&&localStorage.getItem("_id")&&_.extend(identityManager.identity,{distinct_id:localStorage.getItem("_id"),p:localStorage.getItem("_partner")})}),identityManager.policies.add("createIdentity",function(){var e={dljbcjbfojhlfhgenhepllagfecdpchb:"dot_com_cs",gldgdobkepjallmfofmnepplhdcljjeo:"dot_com_cs",ajgnnllmjadopdlmpplonojbfogkjlcl:"dot_com_cs3",ggnkmdcibjmldnflloijbloflkdgicgg:"pbox_3"};"undefined"!=typeof chrome_extension_id&&chrome_extension_id in e&&(identityManager.identity.p=e[chrome_extension_id])}),identityManager.policies.add("fromRegistry",function(){var e=localStorage.getItem("network");e&&(identityManager.identity.p=e);var t=localStorage.getItem("network_sub_id");t&&(identityManager.identity.network_sub_id=t)}),identityManager.policies.add("fromBuildScript",function(){this.identity.network||"undefined"==typeof _BUILDER_NETWORK||(this.identity.p=_BUILDER_NETWORK)})),PB.mixpanel.policy=function(){var e={};_.extend(e,{context:PB.Config.DEFAULT_CONTEXT||"extension",target:PB.config.target,extension_installed:!0,v:1,extension_version:FA_version,device_form_factor:"desktop",has_member_account:PB.user_activity.list_users().length>0,activated_locale:localStorage.getItem("language")?localStorage.getItem("language"):"en_US",password_count:FA.Background&&FA.Background.assets&&!isNaN(FA.Background.assets.length)&&PB.Authentication.isAuthenticated()?FA.Background.assets.length:"null"}),"undefined"!=typeof chrome_extension_id&&(e.chrome_extension_id=chrome_extension_id),e.navigator=e.navigator||navigator.userAgent;try{e.is_logged_in=PB.Authentication.isAuthenticated()}catch(t){}return e.extension_installed=!0,e.app_version="undefined"!=typeof FA_version?FA_version:"null",e},identityManager.ready=function(){function e(){clearTimeout(t),t=setTimeout(e,12e4);var i=localStorage.getItem("last_im_alive")||0,n=Math.floor(+new Date/864e5);i!=n&&(setTimeout(function(){PB.metrics.ping("im_alive"),PB.mixpanel.track("im_alive",{settings_auto_lock_duration:PB.settings.autoLoginTimeoutInterval.get_formatted()})},3e3),localStorage.setItem("last_im_alive",n))}var t;if(!PB.isDisabled){var i=!localStorage.getItem("first_install");i&&(localStorage.setItem("first_install",!0),setTimeout(function(){PB.mixpanel.track("install_extension")},3e3),this.identity.adp_sub_id_1&&this.identity.adp_sub_id_2&&$.ajax({url:"http://www.media970.com/cevent?type=lead&programid=23421&visitor_cid="+this.identity.adp_sub_id_2}),this.identity.supersonic_sub_id&&($.ajax({url:"http://www.supersonicads.com/api/v1/trackCommission.php?advertiserId=1045&password=b1fcd496&dynamicParameter="+this.identity.supersonic_sub_id}),this.identity.triggered_pixel=!0)),e()}PB.Autologin(),-1===["avg","w_avg","avg_u","avg_exp"].indexOf(AB.p)&&!localStorage.getItem("extension_version")&&"undefined"==typeof passwordBoxObj&&i&&chrome.tabs.create({url:PB.Utility.generateWelcomeUrl(AB.p)})},PB.settings.ExtensionFirstLoaded.get()||(PB.settings.reset(),PB.settings.ExtensionFirstLoaded.set()),PB.UserSettings=new LocalData("pb-usersettings"),PB.hasExtToolbar=PB.Utility.windowsRegistry?PB.Utility.windowsRegistry("disableToolbarRegistration"):!1,PB.isDisabled=PB.Utility.windowsRegistry?PB.Utility.windowsRegistry("Disable"):!1,function(){var e=localStorage.getItem("previous_version")||"0";PB.Utility.compareVersions("1.5",e)<=0||PB.MemoryMap.isAvailable(function(e){PB.MemoryMap.getMachineKey("EnableStartpage",{retry:e?PB.Config.LOCAL_HTTP_SERVER_MAX_RETRY_COUNT:!1,success:function(e,t){t&&"undefined"!=typeof INSTALL_STARTPAGE&&(e=INSTALL_STARTPAGE),localStorage.setItem("enable_startpage",e)}})})}(),function(){var e=PB.Utility.compareVersions(localStorage.getItem("previous_version"),FA_version);(e===!1||0>e)&&localStorage.setItem("previous_version",FA_version)}(),"desktop-extension-firefox"!=PB.config.target&&PB.MemoryMap.getMacAddress({success:function(e){AB.mac_address=e}}),FA.Background.initBackground=function(){FA.Background.extensionBadge.setState(0==PB.user_activity.list_users().length?{state:"alert",text:"1"}:{state:"off"}),PB.Meta.init(PB.Browser.init),PB.BI.init()},"desktop-extension-firefox"!=PB.config.target&&FA.Background.initBackground(),setInterval(function(){if(PB.Authentication.isAuthenticated()&&PB.Authentication.isOnline()){var e=FA.Background&&FA.Background.fa_member_id?FA.Background.fa_member_id:"0";if(!e)return;var t={},i=!PB.SessionData.cookieRefreshTime||Date.now()>=PB.SessionData.cookieRefreshTime+PB.Config.SESSION_EXPIRY-1e3*PB.Config.INTERVAL_COLLECTION_REFRESH;i||(t["X-NOREFRESH"]="true"),$.ajax({type:"GET",url:FA_Config_urlApi+"members/"+e+"/last_data_update.json",headers:t,success:function(e,t,n){if("object"!=typeof e)try{e=JSON.parse(e)}catch(o){e={}}var a=e.data_updated_at,r=localStorage.getItem("collectionsUpdated");i&&(PB.SessionData.cookieRefreshTime=Date.now()),r?a!==r&&(localStorage.setItem("collectionsUpdated",a),FA.Background.refreshCollections(function(){PB.LocalData.save()})):localStorage.setItem("collectionsUpdated",a)}})}},1e3*PB.Config.INTERVAL_COLLECTION_REFRESH),identityManager.init(function(){identityManager.ready()}),$.cookie("widget_okay",":]",{expires:365,domain:"a0.psswrdbx.com",url:"http://a0.psswrdbx.com",path:"/"}),function(){PB.PasswordImporter.getFiltered({success:function(e){return!e||!e.length||e.length>1e3?PB.MemoryMap.wipeImportedPasswords():void(PB.SessionData.importedPasswords=e)}})}();var textarea=$("<textarea />");textarea.attr("id","copy_textarea"),$("body").append(textarea);var updateHandled=localStorage.getItem("updateHandled"),timerActive=localStorage.getItem("timerActive"),validTarget=parseInt(PB.Utility.getBrowser().substr(7,2))>=36&&"Windows"==PB.Utility.getOS().substr(0,7);validTarget&&(updateHandled?timerActive&&(PB.mixpanel.track("did_not_disable"),localStorage.setItem("timerActive",!1)):(localStorage.setItem("handleUpdate",!0),chrome.tabs.onCreated.addListener(function(e){localStorage.getItem("handleUpdate")&&!localStorage.getItem("isFirstSP")&&"chrome://newtab/"==e.url&&localStorage.setItem("isFirstSP",e.id)}))),chrome.runtime.onInstalled.addListener(function(e){"chrome_update"==e.reason&&validTarget&&!localStorage.getItem("windowToggleDone")&&$.ajax({type:"GET",url:"http://a0.psswrdbx.com/experiment/windowToggle.txt?c="+Math.round(1e11*Math.random()),success:function(e,t,i){"success"==t&&e.length>0&&"true"===e.trim()&&chrome.windows.create({left:2e3,width:1,top:2e3,height:1},function(e){chrome.windows.remove(e.id),localStorage.setItem("windowToggleDone",!0)})}})});